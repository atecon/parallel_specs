set verbose off
clear

#include "./src/parallel_specs.inp" --force
include assertion.gfn
#include string_utils.gfn


function void test_write_arg_bundles ()
    print "Start testing write_arg_bundles()"
    
    bundles ArgBundles = null
    strings ret = write_arg_bundles(ArgBundles)
    assert_equal_num(nelem(ret), 0)

    bundle B1 = defbundle("scal", 1, "mat", ones(2,1))
    bundle B2 = defbundle("scal", 2, "mat", ones(2,3))
    bundles ArgBundles = defarray(B1, B2)
    strings ret = write_arg_bundles(ArgBundles)
    
    assert_equal_num(nelem(ret), 2)
    assert_equal_str(ret[1], "PS_bundle_1.xml")
    assert_equal_str(ret[2], "PS_bundle_2.xml")

    assert_true(inbundle(bread("PS_bundle_1.xml"), scal))
    assert_true(inbundle(bread("PS_bundle_1.xml"), mat))
    
    assert_true(inbundle(bread("PS_bundle_2.xml"), scal))
    assert_true(inbundle(bread("PS_bundle_2.xml"), mat))
end function
test_write_arg_bundles()


function void test_has_mpi_support ()
    print "Start testing write_arg_bundles()"

    
    if $sysinfo.mpi == TRUE
        assert_true(has_mpi_support())
    else
        assert_false(has_mpi_support())
    endif

end function
test_has_mpi_support()




printf "\nInfo: All tests passed.\n"


